<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="Document">
      <Property name="creationType">com.bstek.cms.orm.Document</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">ID</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
        <Property name="label">标题</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="createDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建时间</Property>
      </PropertyDef>
      <PropertyDef name="startDate">
        <Property name="dataType">Date</Property>
        <Property name="label">有效期</Property>
      </PropertyDef>
      <PropertyDef name="endDate">
        <Property name="dataType">Date</Property>
        <Property name="label">至</Property>
      </PropertyDef>
      <PropertyDef name="content">
        <Property></Property>
        <Property name="label">内容</Property>
      </PropertyDef>
      <PropertyDef name="type">
        <Property></Property>
        <Property name="label">类型</Property>
      </PropertyDef>
      <PropertyDef name="deptId">
        <Property></Property>
        <Property name="label">部门</Property>
      </PropertyDef>
      <PropertyDef name="order">
        <Property name="dataType">Integer</Property>
        <Property name="label">序号</Property>
      </PropertyDef>
      <PropertyDef name="programaName">
        <Property></Property>
        <Property name="label">所属栏目名称</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改时间</Property>
      </PropertyDef>
      <PropertyDef name="top">
        <Property name="dataType">boolean</Property>
        <Property name="label">置顶</Property>
      </PropertyDef>
      <PropertyDef name="browseNumber">
        <Property name="dataType">Integer</Property>
        <Property name="label">浏览次数</Property>
      </PropertyDef>
      <PropertyDef name="securityLevel">
        <Property name="label">密级</Property>
        <Property name="mapping">
          <Property name="mapValues">${dict.items(&quot;MJ&quot;)}</Property>
          <Property name="valueProperty">value</Property>
          <Property name="keyProperty">key</Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="status">
        <Property name="label">状态</Property>
        <Property name="mapping">
          <Property name="mapValues">${dict.items(&quot;DS&quot;)}</Property>
          <Property name="valueProperty">value</Property>
          <Property name="keyProperty">key</Property>
        </Property>
      </PropertyDef>
    </DataType>
    <DataType name="Programa">
      <Property name="creationType">com.bstek.cms.orm.Programa</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">ID</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
        <Property name="label">栏目名称</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property></Property>
        <Property name="label">上级ID</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="createTime">
        <Property name="dataType">Date</Property>
        <Property name="label">创建时间</Property>
      </PropertyDef>
      <PropertyDef name="order">
        <Property name="dataType">Integer</Property>
        <Property name="label">序号</Property>
      </PropertyDef>
      <PropertyDef name="documents">
        <Property name="dataType">[Document]</Property>
      </PropertyDef>
      <PropertyDef name="desc">
        <Property></Property>
        <Property name="label">描述</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View layout="vbox">
    <ClientEvent name="onReady" signature="self,arg,ueditor">/*&#xD;
if (localStorage.pagecount) {&#xD;
    localStorage.pagecount = Number(localStorage.pagecount) + 1;&#xD;
} else {&#xD;
    localStorage.pagecount = 1;&#xD;
}&#xD;
alert(localStorage.pagecount);&#xD;
*/&#xD;
&#xD;
window.setTimeout(function() {&#xD;
	document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
	document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
	var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
	ueditor.set(&quot;height&quot;, height);&#xD;
}, 300);&#xD;
&#xD;
//**********************************************&#xD;
</ClientEvent>
    <ClientEvent name="onClick" signature="self,arg,programaPanel">programaPanel.hide();&#xD;
</ClientEvent>
    <Property name="packages">font-awesome,colors</Property>
    <Property name="contentOverflow">hidden</Property>
    <DataSet id="dsDocument">
      <ClientEvent name="beforeLoadData">var param = &quot;${param.name}&quot;;&#xD;
var name = param.replace(/\-/g, &quot;%&quot;);&#xD;
&#xD;
self.set(&quot;parameter&quot;, name);&#xD;
&#xD;
&#xD;
&#xD;
</ClientEvent>
      <ClientEvent name="onLoadData" signature="self,arg,title,creator,ajaxAction,dateCount">var param = {&#xD;
	docId: null,&#xD;
	browseNumber: null&#xD;
};&#xD;
var doc = self.getData(&quot;#&quot;);&#xD;
&#xD;
title.set(&quot;text&quot;, doc.get(&quot;name&quot;));&#xD;
&#xD;
if (doc.get(&quot;browseNumber&quot;) == null) {	&#xD;
	creator.set(&quot;text&quot;, &quot; &quot; + doc.get(&quot;creator&quot;));&#xD;
	dateCount.set(&quot;text&quot;, &quot; &quot; + doc.get(&quot;createDate&quot;).formatDate(&quot;Y-m-d&quot;)&#xD;
		 + &quot; 浏览次数  : &quot; + 1);&#xD;
	&#xD;
	param.browseNumber = 1;&#xD;
} else {&#xD;
	var number = doc.get(&quot;browseNumber&quot;) + 1;&#xD;
	&#xD;
	creator.set(&quot;text&quot;, &quot; &quot; + doc.get(&quot;creator&quot;)&#xD;
		 &#xD;
	);&#xD;
	dateCount.set(&quot;text&quot;, &quot; &quot; + doc.get(&quot;createDate&quot;).formatDate(&quot;Y-m-d&quot;)&#xD;
		 + &quot; 浏览次数  : &quot; + number);&#xD;
	&#xD;
	param.browseNumber = number;&#xD;
}&#xD;
&#xD;
param.docId = doc.get(&quot;id&quot;);&#xD;
ajaxAction.set(&quot;parameter&quot;, param).execute();&#xD;
&#xD;
</ClientEvent>
      <Property name="dataProvider">textTemplateController#loadDocumentByName</Property>
      <Property name="dataType">[Document]</Property>
      <Property name="loadMode">onReady</Property>
    </DataSet>
    <Container layout="hbox">
      <ClientEvent name="onCreateDom">$(arg.dom).addClass();&#xD;
</ClientEvent>
      <Property name="style">
        <Property name="border">1px solid</Property>
        <Property name="border-color">#d0d0d0</Property>
      </Property>
      <Property name="height">65</Property>
      <Property name="width">100%</Property>
      <Property name="contentOverflow">hidden</Property>
      <Label>
        <ClientEvent name="onClick">window.location.href = &quot;com.bstek.cms.web.portal.Portal2.d&quot;;</ClientEvent>
        <Property name="exClassName">fa fa-language</Property>
        <Property name="text">  内容管理系统</Property>
        <Property name="style">
          <Property name="key"></Property>
        </Property>
      </Label>
      <TextEditor id="search">
        <ClientEvent name="onKeyDown">window.clearTimeout(self.urlQueryTimeout);&#xD;
self.urlQueryTimeout = window.setTimeout(function() {&#xD;
	var key = self.get(&quot;value&quot;);&#xD;
	if (key &amp;&amp; arg.keyCode == 13) {&#xD;
		window.location.href = &quot;com.bstek.cms.web.portal.search.SearchResult1.d?value=&quot; + key;&#xD;
	}&#xD;
}, 500);</ClientEvent>
        <ClientEvent name="onFocus">&#xD;
var width = 400;&#xD;
window.setInterval(function() {&#xD;
	width = width + 20;&#xD;
	if (width &lt;= 500) {&#xD;
		self.set(&quot;width&quot;, width);&#xD;
	} else {&#xD;
		window.clearInterval();&#xD;
	}&#xD;
}, 55);&#xD;
&#xD;
</ClientEvent>
        <ClientEvent name="onBlur">&#xD;
var width = 500;&#xD;
window.setInterval(function() {&#xD;
	width = width - 20;&#xD;
	if (width > 400) {&#xD;
		self.set(&quot;width&quot;, width);&#xD;
	} else {&#xD;
		window.clearInterval();&#xD;
	}&#xD;
}, 55);&#xD;
&#xD;
</ClientEvent>
        <ClientEvent name="onCreateDom">$(arg.dom).addClass(&quot;searchBox&quot;);&#xD;
</ClientEvent>
        <Property name="blankText">按标题搜索...</Property>
        <Property name="exClassName">fa fa-search</Property>
        <Property name="width">400</Property>
        <Property name="trigger">dataSetDropDown</Property>
      </TextEditor>
      <Label>
        <ClientEvent name="onCreateDom">$(arg.dom).off(&quot;click&quot;);&#xD;
$(arg.dom)&#xD;
	.addClass(&quot;issueBtn&quot;)&#xD;
	.click(function() {&#xD;
		var username = &quot;${loginUsername}&quot;;&#xD;
		if (username) {&#xD;
			window.open(&quot;com.bstek.cms.web.portal.issue.DocumentIssue1.d&quot;);&#xD;
		} else {&#xD;
			dorado.MessageBox.alert(&quot;请先登录！&quot;);&#xD;
		}&#xD;
		return false;&#xD;
	});</ClientEvent>
        <Property name="exClassName">fa fa-share-square-o</Property>
        <Property name="text"> 发布</Property>
      </Label>
      <Label>
        <ClientEvent name="onCreateDom" signature="self,arg,programaPanel">$(arg.dom).off(&quot;click&quot;);&#xD;
$(arg.dom)&#xD;
	.addClass(&quot;programaBtn&quot;)&#xD;
	.click(function() {&#xD;
		programaPanel.show({&#xD;
			anchorTarget: self,&#xD;
			vAlign: &quot;bottom&quot;,&#xD;
			offsetTop: 38,&#xD;
			offsetLeft: 72&#xD;
		});			&#xD;
		return false;&#xD;
	});</ClientEvent>
        <Property name="exClassName">fa fa-th</Property>
        <Property name="tip">栏目列表</Property>
      </Label>
      <Button>
        <ClientEvent name="onClick">if (self.get(&quot;caption&quot;) ==  &quot;&amp;nbsp;登&amp;nbsp;陆&quot;) {&#xD;
	window.open(&quot;bdf3.security.ui.view.Login.d&quot;);&#xD;
} else {&#xD;
	dorado.MessageBox.confirm(&quot;确认退出？&quot;, function() {&#xD;
		window.location.href = &quot;${configure['bdf3.logoutPath']}&quot;;		&#xD;
	});&#xD;
}&#xD;
&#xD;
</ClientEvent>
        <ClientEvent name="onReady">var username = &quot;${loginUsername}&quot;;&#xD;
if (username) {&#xD;
	self.set(&quot;caption&quot;, username);&#xD;
} else {&#xD;
	self.set(&quot;caption&quot;, &quot;&amp;nbsp;登&amp;nbsp;陆&quot;);&#xD;
}&#xD;
</ClientEvent>
        <ClientEvent name="onCreateDom">$(arg.dom).addClass(&quot;loginBtn&quot;);&#xD;
</ClientEvent>
        <Property name="caption"> 登 陆</Property>
        <Property name="style">
          <Property name="font-weight">bold</Property>
        </Property>
      </Button>
    </Container>
    <Container id="homePage" layout="vbox" layoutConstraint="align:center">
      <Property name="width">900</Property>
      <Property name="height">auto</Property>
      <Label id="title">
        <ClientEvent name="onCreateDom">$(arg.dom).addClass(&quot;title&quot;);&#xD;
</ClientEvent>
        <Property name="style">
          <Property name="margin-top">50px</Property>
          <Property name="font-weight">bold</Property>
          <Property name="color">#3C3C3C</Property>
        </Property>
        <Property name="height">60</Property>
      </Label>
      <Container layoutConstraint="align:left">
        <Property name="width">890</Property>
        <Property name="style">
          <Property name="margin-top">20px</Property>
        </Property>
        <Image layoutConstraint="left">
          <Property name="image">/static/images/touxiang.jpg</Property>
          <Property name="width">50</Property>
          <Property name="height">50</Property>
        </Image>
        <Container>
          <Property name="width">300</Property>
          <Property name="height">50</Property>
          <Property name="style">
            <Property name="padding-left">20px</Property>
          </Property>
          <Label id="creator">
            <Property name="style">
              <Property name="font-size">16px</Property>
              <Property name="color">#000000</Property>
            </Property>
          </Label>
          <Label id="dateCount">
            <Property name="style">
              <Property name="font-size">16px</Property>
              <Property name="color">#ADADAD</Property>
            </Property>
          </Label>
        </Container>
      </Container>
      <UEditor id="ueditor">
        <ClientEvent name="onCreate">dorado.ueditor.registerMode(&quot;custom&quot;, []);&#xD;
</ClientEvent>
        <ClientEvent name="onReady">&#xD;
//当浏览器宽度改变&#xD;
window.onresize = function() {  &#xD;
	var winWidth;&#xD;
	if (window.innerWidth) {&#xD;
		winWidth = window.innerWidth;&#xD;
	} else if ((document.body) &amp;&amp; (document.body.clientWidth)) {&#xD;
		winWidth = document.body.clientWidth; &#xD;
	}&#xD;
	&#xD;
	if (winWidth >= 900) {&#xD;
		self.set(&quot;width&quot;, 880);&#xD;
		self.get(&quot;parent&quot;).set(&quot;width&quot;, 900);&#xD;
		window.setTimeout(function() {&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
			var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
			self.set(&quot;height&quot;, height + 50);&#xD;
		}, 300);&#xD;
	} else if (winWidth >= 620 &amp;&amp; winWidth &lt; 900) {&#xD;
		self.set(&quot;width&quot;, 600);&#xD;
		self.get(&quot;parent&quot;).set(&quot;width&quot;, 600);&#xD;
		window.setTimeout(function() {&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
			var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
			self.set(&quot;height&quot;, height + 50);&#xD;
		}, 300);&#xD;
	} else if (winWidth > 450 &amp;&amp; winWidth &lt; 620) {&#xD;
		self.set(&quot;width&quot;, 450);&#xD;
		self.get(&quot;parent&quot;).set(&quot;width&quot;, 450);&#xD;
		window.setTimeout(function() {&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
			var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
			self.set(&quot;height&quot;, height + 50);&#xD;
		}, 300);&#xD;
	}  else {&#xD;
		self.set(&quot;width&quot;, 300);&#xD;
		self.get(&quot;parent&quot;).set(&quot;width&quot;, 300);&#xD;
		window.setTimeout(function() {&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
			document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
			var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
			self.set(&quot;height&quot;, height + 50);&#xD;
		}, 300);&#xD;
	}&#xD;
}</ClientEvent>
        <ClientEvent name="onRefreshDom">var winWidth;&#xD;
if (window.innerWidth) {&#xD;
	winWidth = window.innerWidth;&#xD;
} else if ((document.body) &amp;&amp; (document.body.clientWidth)) {&#xD;
	winWidth = document.body.clientWidth; &#xD;
}&#xD;
&#xD;
if (winWidth >= 900) {&#xD;
	self.set(&quot;width&quot;, 880);&#xD;
	self.get(&quot;parent&quot;).set(&quot;width&quot;, 900);&#xD;
	window.setTimeout(function() {&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
		var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
		self.set(&quot;height&quot;, height + 50);&#xD;
	}, 300);&#xD;
} else if (winWidth >= 620 &amp;&amp; winWidth &lt; 900) {&#xD;
	self.set(&quot;width&quot;, 600);&#xD;
	self.get(&quot;parent&quot;).set(&quot;width&quot;, 600);&#xD;
	window.setTimeout(function() {&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
		var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
		self.set(&quot;height&quot;, height + 50);&#xD;
	}, 300);&#xD;
} else if (winWidth > 450 &amp;&amp; winWidth &lt; 620) {&#xD;
	self.set(&quot;width&quot;, 450);&#xD;
	self.get(&quot;parent&quot;).set(&quot;width&quot;, 450);&#xD;
	window.setTimeout(function() {&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
		var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
		self.set(&quot;height&quot;, height + 50);&#xD;
	}, 300);&#xD;
}  else {&#xD;
	self.set(&quot;width&quot;, 300);&#xD;
	self.get(&quot;parent&quot;).set(&quot;width&quot;, 300);&#xD;
	window.setTimeout(function() {&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.height=&quot;auto&quot;;&#xD;
		document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.style.overflow=&quot;hidden&quot;;&#xD;
		var height = document.getElementById(&quot;ueditor_0&quot;).contentWindow.document.body.offsetHeight;&#xD;
		self.set(&quot;height&quot;, height + 50);&#xD;
	}, 300);&#xD;
}</ClientEvent>
        <Property name="mode">custom</Property>
        <Property name="readOnly">true</Property>
        <Property name="dataSet">dsDocument</Property>
        <Property name="property">content</Property>
        <Property name="defaultFontSize">22px</Property>
        <Property name="style">
          <Property name="color">#5B5B5B</Property>
        </Property>
        <Property name="width">890</Property>
      </UEditor>
    </Container>
    <AjaxAction id="ajaxAction">
      <Property name="service">textTemplateController#saveBrowseNumber</Property>
    </AjaxAction>
    <FloatPanel id="programaPanel">
      <ClientEvent name="onShow" signature="self,arg,dsPrograma">dsPrograma.flushAsync();&#xD;
</ClientEvent>
      <Property name="width">340</Property>
      <Property name="animateType">zoom</Property>
      <Property name="style">
        <Property name="min-height">380px</Property>
      </Property>
      <Property name="height">380</Property>
      <Buttons/>
      <Children>
        <DataSet id="dsPrograma">
          <ClientEvent name="onLoadData" signature="self,arg,bvPrograma">var items = [];&#xD;
var programas = self.getData();&#xD;
programas.each(function(p) {&#xD;
	var type = p.get(&quot;name&quot;);&#xD;
&#xD;
	var item = {&#xD;
		type: type,&#xD;
		items: p.get(&quot;documents&quot;)&#xD;
	};&#xD;
	items.push(item);&#xD;
});&#xD;
&#xD;
bvPrograma.set(&quot;items&quot;, items);</ClientEvent>
          <Property name="dataType">[Programa]</Property>
          <Property name="dataProvider">portalController#loadTopPrograma</Property>
        </DataSet>
        <BlockView id="bvPrograma">
          <ClientEvent name="onRenderBlock">$(arg.dom).empty();&#xD;
var $h = $(&quot;&lt;h4 class='ex header'>&lt;i class='fa fa-dropbox grey-text'>&lt;/i>&lt;br>&lt;h2>&quot;+ arg.data.type +&quot;&lt;/h2>&lt;/h4>&quot;).appendTo(arg.dom);&#xD;
$h.click(function() {&#xD;
	if (arg.data.type == &quot;首页&quot;) {&#xD;
		window.location.href = &quot;com.bstek.cms.web.portal.Portal1.d&quot;;&#xD;
	} else {&#xD;
		window.location.href = &quot;com.bstek.cms.web.portal.more.MoreDocumentQuery1.d?programaName=&quot; + arg.data.type;&#xD;
	}&#xD;
});&#xD;
</ClientEvent>
          <Property name="lineSize">3</Property>
          <Property name="width">336</Property>
          <Property name="blockHeight">100</Property>
          <Property name="blockWidth">100</Property>
        </BlockView>
      </Children>
      <Tools/>
    </FloatPanel>
    <DataSetDropDown id="dataSetDropDown">
      <ClientEvent name="onFilterItems" signature="self,arg,dsAllDocuments">dsAllDocuments.flush();</ClientEvent>
      <ClientEvent name="onValueSelect">window.location.href = &quot;com.bstek.cms.web.portal.text.TextTemplate1.d?name=&quot; + arg.selectedValue;</ClientEvent>
      <Property name="dataSet">dsAllDocuments</Property>
      <Property name="width">490</Property>
      <Property name="height">0</Property>
      <Property name="autoOpen">true</Property>
      <Property name="buttonVisible">false</Property>
      <Property name="dynaFilter">true</Property>
      <Property name="editable">false</Property>
      <Property name="filterOnTyping">true</Property>
      <Property name="filterOnOpen">true</Property>
      <Property name="property">name</Property>
      <Property name="filterMode">serverSide</Property>
    </DataSetDropDown>
    <DataSet id="dsAllDocuments">
      <ClientEvent name="beforeLoadData" signature="self,arg,search">var value = search.get(&quot;text&quot;);&#xD;
if (value) {&#xD;
	self.set(&quot;parameter&quot;, value);&#xD;
} else {&#xD;
	self.set(&quot;parameter&quot;, &quot;&quot;);&#xD;
}&#xD;
</ClientEvent>
      <ClientEvent name="onLoadData">self.getData().setCurrent(&quot;&quot;);</ClientEvent>
      <Property name="dataType">[Document]</Property>
      <Property name="dataProvider">portalController#loadAllDocuments</Property>
    </DataSet>
  </View>
</ViewConfig>
